<!DOCTYPE html>
<html>
<head>

<script>
	
	function getXmlHttpRequestObject() {
		 if (window.XMLHttpRequest) {
			 return new XMLHttpRequest();
		 } else if (window.ActiveXObject) {
			 return new ActiveXObject("Microsoft.XMLHTTP");
		 } else {
			 alert("Your Browser does not support AJAX!\nIt's about time to upgrade don't you think?");
		 }
		 
	 }
 
//XmlHttpRequest object
var req = getXmlHttpRequestObject();
// Main interval to poll HAL status from server
//var SnapShotInterval = setInterval(getRequestRefresh, 150);

var Seconds = 0;
var HandlerCounter = 0;
setInterval(IncreaseFreqCount, 1000);

function IncreaseFreqCount()
{
	Seconds = Seconds + 1;
	Num = HandlerCounter / Seconds;
	txt = HandlerCounter.toFixed(1) + "/" + Seconds.toFixed(1) + "=" + Num.toFixed(1);
	document.getElementById("freq").innerHTML=txt;
}

function getRequestRefresh()
 {
	 getRequest('/data/SnapShot.xml', 'Refresh', handleResponse);
 }

function getRequestRecognize()
 {
	 //clearInterval(SnapShotInterval);
	 getRequest('/data/SnapShot.xml', 'Recog', handleResponse2);
	 return false;
 }

function getRequest(resource, command, handleResponse)
 {
	// Stop SnapShot interval until this request will have been served
	//clearInterval(SnapShotInterval);
 	//resource = '/data/MasterName.xml?Cmd=Recog';
	// handle the case where a querystring is not detected
	String = resource + "?" + 'Cmd=' + command + "&" + 'ms=' + new Date().getTime();
	//alert(String);
	
 	if (req.readyState == 4 || req.readyState == 0) {
		 req.open("GET", String, true);
	 	 req.onreadystatechange = handleResponse;
	 	 req.send(null);
	 	 return false;
 	}
 }

function handleResponse()
 {
	if (req.readyState == 4) 
	{
		parseState(req.responseXML);
		HandlerCounter = HandlerCounter + 1;
	}
} 

function handleResponse2()
 {
	if (req.readyState == 4) 
	{
		parseState(req.responseXML);
		// Restart SnapShot interval
		//SnapShotInterval = setInterval(getRequestRefresh, 150);
	}
} 

function parseState(xmlDoc)
{
	if(xmlDoc == null)
		return;
	x=xmlDoc.getElementsByTagName("Master");
	txt="<table border='1'><tr><th>Type</th><th>ID</th><th>SubType</th><th>Dir.</th><th>Slot</th><th>Value</th><th>Notes</th></tr>";
	// Check if the master list is empty
	if ( x.length == 0 )
	{
		txt=txt + "<tr>";
		txt=txt + "<td>" + "NO MASTER!!!" + "</td>";
		txt=txt + "</tr>";
	}
	else
	{
		// Build the Masters table
		for (i=0;i<x.length;i++)
		{
			txt=txt + "<tr>";
			// Type Master
			txt=txt + "<td>" + "Master" + "</td>";
			xx = x[i].attributes;
			// 1th child is the Id
            txt=txt + "<td>" + xx[1].firstChild.nodeValue + "</td>";
			// 0th child is the Name
            txt=txt + "<td>" + xx[0].firstChild.nodeValue + "</td>";
			txt=txt + "</tr>";
			// Loop on slaves
			y = x[i].getElementsByTagName("Slave");
			for (j=0;j<y.length;j++)
			{
				// Type Slave
				txt=txt + "<tr>";
				txt=txt + "<td>" + "Slave" + "</td>";
				yy = y[j].attributes;
				// 1th child is the Id
	            txt=txt + "<td>" + yy[1].firstChild.nodeValue + "</td>";
				// 0th child is the Type
	            txt=txt + "<td>" + yy[0].firstChild.nodeValue + "</td>";
				txt=txt + "</tr>";
				// Loop on pins
				z = y[j].getElementsByTagName("Pin");
				for (k=0;k<z.length;k++)
				{
					// Type Pin
					txt=txt + "<tr>";
					txt=txt + "<td>" + "Pin" + "</td>";
					zz = z[k].attributes;
					// 1th child is the Id
		            txt=txt + "<td>" + zz[1].firstChild.nodeValue + "</td>";
					// 0th child is the Type
		            txt=txt + "<td>" + zz[0].firstChild.nodeValue + "</td>";
					txt=txt + "</tr>";
				}
			}
		}
	}
    txt=txt + "</table>";
    document.getElementById('MasterTable').innerHTML=txt;
	x=xmlDoc.getElementsByTagName("SnapShot");
	fps=(x[0].getElementsByTagName("fps")[0].childNodes[0].nodeValue);
	txt="fps: " + fps;
	document.getElementById("fps").innerHTML=txt;
}

</script>

</head>
<body>

<button onclick="getRequestRecognize();">Recognize</button>
<div id='MasterTable'></div><br>
<div id='fps'></div><br>
Refresh freq:<div id='freq'></div><br>
First name: <input type="text" name="FirstName" value="Mickey"><br>
Last name: <input type="text" name="LastName" value="Mouse"><br>

</body>
</html>
